---
import PageLayout from '../layouts/PageLayout.astro';
import cvData from '../data/cv-data.json';

const pageTitle = "Curriculum Vitae | Dr. John P. Krasting";
const pageDescription = "Complete CV for Dr. John P. Krasting, climate scientist specializing in sea level rise and ocean dynamics.";

// Calculate total funding
const totalFunding = cvData.funding.reduce((sum, grant) => {
  const amount = grant.amount || grant.totalAmount || grant.institutionalAmount || 0;
  return sum + amount;
}, 0);
---

<PageLayout title={pageTitle} description={pageDescription}>
  <div class="max-w-4xl mx-auto">
    <!-- Page Header -->
    <div class="text-center mb-12">
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-medium tracking-tighter mb-4">
        Curriculum Vitae
      </h1>
      <p class="text-muted-foreground text-lg mb-6">
        {cvData.personal.name}, {cvData.personal.title}
      </p>
      <a
        href="/Krasting_CV.pdf"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-background rounded-full font-medium hover:opacity-90 transition-opacity"
      >
        Download PDF
        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.50005 1.04999C7.74858 1.04999 7.95005 1.25146 7.95005 1.49999V8.41359L10.1819 6.18179C10.3576 6.00605 10.6425 6.00605 10.8182 6.18179C10.994 6.35753 10.994 6.64245 10.8182 6.81819L7.81825 9.81819C7.64251 9.99392 7.35759 9.99392 7.18185 9.81819L4.18185 6.81819C4.00611 6.64245 4.00611 6.35753 4.18185 6.18179C4.35759 6.00605 4.64251 6.00605 4.81825 6.18179L7.05005 8.41359V1.49999C7.05005 1.25146 7.25152 1.04999 7.50005 1.04999ZM2.5 10C2.77614 10 3 10.2239 3 10.5V12C3 12.5523 3.44772 13 4 13H11C11.5523 13 12 12.5523 12 12V10.5C12 10.2239 12.2239 10 12.5 10C12.7761 10 13 10.2239 13 10.5V12C13 13.1046 12.1046 14 11 14H4C2.89543 14 2 13.1046 2 12V10.5C2 10.2239 2.22386 10 2.5 10Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path>
        </svg>
      </a>
    </div>

    <!-- Education -->
    <section class="mb-12">
      <h2 class="text-2xl font-medium mb-6 pb-2 border-b">Education</h2>
      <div class="space-y-4">
        {cvData.personal.education.map((edu) => (
          <div class="flex flex-col sm:flex-row sm:justify-between gap-1">
            <div>
              <h3 class="font-medium">{edu.degree} in {edu.field}</h3>
              <p class="text-muted-foreground">{edu.institution}</p>
            </div>
            <span class="text-sm text-muted-foreground">{edu.year}</span>
          </div>
        ))}
      </div>
    </section>

    <!-- Experience -->
    <section class="mb-12">
      <h2 class="text-2xl font-medium mb-6 pb-2 border-b">Professional Experience</h2>
      <div class="space-y-6">
        {cvData.personal.positions.map((pos) => (
          <div class="flex flex-col sm:flex-row sm:justify-between gap-1">
            <div>
              <h3 class="font-medium">{pos.title}</h3>
              <p class="text-muted-foreground">{pos.organization}</p>
            </div>
            <span class="text-sm text-muted-foreground whitespace-nowrap">{pos.startDate} - {pos.endDate}</span>
          </div>
        ))}
      </div>
    </section>

    <!-- Awards -->
    {cvData.awards && cvData.awards.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-medium mb-6 pb-2 border-b">Awards & Recognition</h2>
        <div class="space-y-4">
          {cvData.awards.map((award) => (
            <div class="flex flex-col sm:flex-row sm:justify-between gap-1">
              <div>
                <h3 class="font-medium">{award.title}</h3>
                <p class="text-muted-foreground">{award.organization}</p>
              </div>
              <span class="text-sm text-muted-foreground">{award.year}</span>
            </div>
          ))}
        </div>
      </section>
    )}

    <!-- Research Funding -->
    {cvData.funding && cvData.funding.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-medium mb-6 pb-2 border-b">Research Funding</h2>
        <p class="text-muted-foreground mb-4">
          Total funding as PI/Co-PI: <span class="font-medium text-foreground">${(totalFunding / 1000000).toFixed(2)}M</span>
        </p>
        <div class="space-y-4">
          {cvData.funding.slice(0, 5).map((grant) => (
            <div>
              <h3 class="font-medium">{grant.title}</h3>
              <p class="text-sm text-muted-foreground">
                {grant.funder} | {grant.role} | ${((grant.amount || grant.totalAmount || grant.institutionalAmount || 0) / 1000000).toFixed(2)}M
              </p>
            </div>
          ))}
        </div>
      </section>
    )}
  </div>
</PageLayout>
